From cc3dc6f5bac7c388dac1ebccc4bb3836d8d8b121 Mon Sep 17 00:00:00 2001
From: Chad Waters <authorblues@gmail.com>
Date: Sun, 20 Jan 2013 22:04:58 -0500
Subject: [PATCH] Fire ServerCommandEvent for command block cmds. Addresses
 BUKKIT-3165

---
 .../net/minecraft/server/TileEntityCommand.java    |    8 ++++++--
 1 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/main/java/net/minecraft/server/TileEntityCommand.java b/src/main/java/net/minecraft/server/TileEntityCommand.java
index 623f87c..941e83a 100644
--- a/src/main/java/net/minecraft/server/TileEntityCommand.java
+++ b/src/main/java/net/minecraft/server/TileEntityCommand.java
@@ -3,6 +3,7 @@ package net.minecraft.server;
 // CraftBukkit start
 import java.util.ArrayList;
 import java.util.Arrays;
+import org.bukkit.event.server.ServerCommandEvent;
 import com.google.common.base.Joiner;
 // CraftBukkit end

@@ -49,9 +50,12 @@ public class TileEntityCommand extends TileEntity implements ICommandListener {
                 if (this.world.players.isEmpty()) {
                     return 0;
                 }
-                // CraftBukkit end

-                return icommandhandler.a(this, this.b);
+                ServerCommandEvent event = new ServerCommandEvent(this.sender, command);
+                world.getServer().getPluginManager().callEvent(event);
+
+                return icommandhandler.a(this, event.getCommand());
+                // CraftBukkit end
             } else {
                 return 0;
             }
--
1.7.4.4

